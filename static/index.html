<!DOCTYPE HTML>
<html>
<head>
	<title>Faraday Cage Match</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #fff;
		}
		canvas {
			display:block;
			margin:0 auto;
		}
	</style>
	<script src="/js/libs/pixi.js"></script>
	<script src="/js/text.js"></script>
	<script src="/js/move.js"></script>
	<script src="/js/pieces.js"></script>

</head>
<body>
	<script>
	var stageWidth = 400;
	var stageHeight = 300;
	var floorHeight = 50;
	var heroHeight = 36;
	var screens = 5;
	var letterWidth = 50;
	var lettersCollected = [];
	var gameOver = false;
	var rotating = true;
	var alphabet = "EEEEEEEEEEEEEEEEEEEEEEEETTTTTOOOOOTTTTTAAAATTTTTOOOOOAAAAAAAAAAAAOOOOOIIIIIIIIIIIIINNNNNNNNNNNNNRRRRRRRRRRRRRSSSSSSSSSSLLLLLLLUUUUUUUDDDDDDDDGGGGGCCCCCCMMMMMMBBBBPPPPHHHHHFFFFWWWWYYYYVVVKKJJXXQQZZ"; //Super Scrabble letter set
	var lettersInPlay = [];
	var hero, midTexture;

	var stage = new PIXI.Stage(0x000000);
	var renderer = PIXI.autoDetectRenderer(stageWidth, stageHeight);
	document.body.appendChild(renderer.view);
	
	var playBegun = false;
	//show directions first
	var instructionsText = "Run along the letter path to\ncollect letters and bonus\nsquares â€¦ click or tap to jump\nletters or evil score-depleting\nsquares. Every eight letters we'll\nscore you by the words you've\ncreated, and subtract from your\nscore letters that couldn't find a\nhome in a word. GO!";
	var textSample = new PIXI.Text(instructionsText, {font: "bold 24px Arial", fill: "white", align: "left"});
	textSample.position.x = 20;
	textSample.position.y = 20;
	stage.addChild(textSample);
  renderer.render(stage);

  //listeners
	renderer.view.addEventListener("touchstart", onTouchStart, true);
	renderer.view.addEventListener("touchend", onTouchEnd, true);
	renderer.view.addEventListener("mousedown",function(event){
		event.preventDefault()
		onClick();
	});
	renderer.view.addEventListener("mouseup",function(event){
		event.preventDefault()
		onRelease();
	});
	
	//game loop
	var forwardSpeed = 2;
	function animate() {
	
		if(!gameOver) {
	    requestAnimFrame( animate );
		}

    for(var i = 0;i<lettersInPlay.length;i++) {
    	lettersInPlay[i].position.x -= forwardSpeed;
    	if(lettersInPlay[i].position.x < 0 - letterWidth) {
    		stage.removeChild(lettersInPlay[i]);
    		lettersInPlay.splice(i,1);
    	}
    }

		if(rotating) {
	    hero.rotation += 0.1;
		}
    mid.tilePosition.x -= forwardSpeed;
    if(mid.tilePosition.x < -parseInt(stageWidth * screens) ) {
    	gameOver = true;
    }

    if(jumping) {
    	if(hero.position.y > 0) {
	    	hero.position.y -= 5;
    	} else {
    		jumping = false;
    	}
    }
    if(falling) {
    	if(hero.position.y < parseInt(stageHeight - floorHeight - (heroHeight / 2) - 1 )) {
	    	hero.position.y += 2;
    	} else {
    		falling = false;
    		rotating = true;
    	}
    }

    letterCollision(lettersInPlay);
	
    // render the stage   
    renderer.render(stage);
	}

	</script>

<div style="background-color:#fff">
<iframe src="http://nodeknockout.com/iframe/faraday-cage-match" frameborder=0 scrolling=no allowtransparency=true width=115 height=25></iframe>
</div>

	</body>
</html>


<!--
	How to background: http://flippinawesome.org/2013/11/04/building-a-parallax-scrolling-game-with-pixi-js/
-->
