<!DOCTYPE HTML>
<html>
<head>
	<title>Faraday Cage Match</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #fff;
		}
		canvas {
			display:block;
			margin:0 auto;
		}
	</style>
	<script src="/js/libs/pixi.js"></script>
	<script src="/js/text.js"></script>
	<script src="/js/move.js"></script>

</head>
<body>
	<script>
	var stageWidth = 400;
	var stageHeight = 300;
	var floorHeight = 50;
	var heroHeight = 36;
	var screens = 5;
	var lettersCollected = [];
	var gameOver = false;

	var stage = new PIXI.Stage(0x000000);
	var renderer = PIXI.autoDetectRenderer(stageWidth, stageHeight);
	document.body.appendChild(renderer.view);
	
	requestAnimFrame( animate );
	
	// hero
	var texture = PIXI.Texture.fromImage("img/gearHeart.png");
	var hero = new PIXI.Sprite(texture);
	hero.anchor.x = 0.5;
	hero.anchor.y = 0.5;
	hero.position.x = 50;
	hero.position.y = 232;	
	stage.addChild(hero);

	//all the letters
	var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	var lettersInPlay = [];
	for(var i = 0;i<alphabet.length;i++) {
		var letter = alphabet[i];
		var yPos = parseInt(Math.random() * stageHeight);
		var xPos = parseInt(Math.random() * stageWidth * screens);
		lettersInPlay.push(makeLetter(letter,xPos,yPos));
		stage.addChild(lettersInPlay[lettersInPlay.length -1]);
	}

	//ground
	var midTexture = PIXI.Texture.fromImage("img/bg-midsml.png");
	mid = new PIXI.TilingSprite(midTexture, 512, 256);
	mid.position.x = 0;
	mid.position.y = 250;
     mid.tilePosition.x = 0;
     mid.tilePosition.y = 0;
	stage.addChild(mid);
	
	//game loop
	var rotating = true;
	function animate() {
	
		if(!gameOver) {
	    requestAnimFrame( animate );
		}

    for(var i = 0;i<lettersInPlay.length;i++) {
    	lettersInPlay[i].position.x -= 1;
    	if(lettersInPlay[i].position.x < 0) {
    		stage.removeChild(lettersInPlay[i]);
    		lettersInPlay.splice(i,1);
    	}
    }

		if(rotating) {
	    hero.rotation += 0.05;
		}
    mid.tilePosition.x -= 1;
    if(mid.tilePosition.x < -parseInt(stageWidth * screens) ) {
    	gameOver = true;
    }

    if(jumping) {
    	if(hero.position.y > 0) {
	    	hero.position.y -= 2;
    	} else {
    		jumping = false;
    	}
    }
    if(falling) {
    	if(hero.position.y < parseInt(stageHeight - floorHeight - (heroHeight / 2) - 1 )) {
	    	hero.position.y += 2;
    	} else {
    		falling = false;
    		rotating = true;
    	}
    }

    letterCollision(lettersInPlay);
	
    // render the stage   
    renderer.render(stage);
	}

	renderer.view.addEventListener("touchstart", onTouchStart, true);
	renderer.view.addEventListener("touchend", onTouchEnd, true);
	renderer.view.addEventListener("mousedown",function(event){
		event.preventDefault()
		onClick();
	});
	renderer.view.addEventListener("mouseup",function(event){
		event.preventDefault()
		onRelease();
	});

	</script>

<div style="background-color:#fff">
<iframe src="http://nodeknockout.com/iframe/faraday-cage-match" frameborder=0 scrolling=no allowtransparency=true width=115 height=25></iframe>
</div>

	</body>
</html>


<!--
	How to background: http://flippinawesome.org/2013/11/04/building-a-parallax-scrolling-game-with-pixi-js/
-->
